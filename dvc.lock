schema: '2.0'
stages:
  train:
    cmd: cd examples/mapping_tester  && ./clean.sh &&./run.sh
    params:
      examples/mapping_tester/setup-test.json:
        general:
          function: 0.78 + cos(10*(x+y+z))
          ranks:
            A:
            - 2
            B:
            - 2
          syncmode: true
          meshes:
            A:
              '0.03': ${TEST_LOCATION}/0.03.vtk
              '0.02': ${TEST_LOCATION}/0.02.vtk
              '0.01': ${TEST_LOCATION}/0.01.vtk
              '0.008': ${TEST_LOCATION}/0.008.vtk
              '0.006': ${TEST_LOCATION}/0.006.vtk
              '0.004': ${TEST_LOCATION}/0.004.vtk
            B:
              '0.009': ${TEST_LOCATION}/0.009.vtk
        groups:
        - mapping:
            constraints:
            - consistent
            cases:
              np:
                kind: nearest-projection
              nn:
                kind: nearest-neighbor
          meshes:
            A:
            - '0.03'
            - '0.02'
            - '0.01'
            - '0.008'
            - '0.006'
            - '0.004'
            B:
            - '0.009'
    outs:
    - path: examples/mapping_tester/case
      md5: 637f34a8721cfe1480b4e458801de929.dir
      size: 58577413
      nfiles: 250
    - path: examples/mapping_tester/test-statistics.csv
      md5: 9e45756355ec5c3b9654c5c87835021b
      size: 3294
  run_testes:
    cmd: cd examples/mapping_tester  && ./clean.sh && ./run.sh
    params:
      examples/mapping_tester/setup-test.json:
        general:
          function: 0.78 + cos(10*(x+y+z))
          ranks:
            A:
            - 2
            B:
            - 2
          syncmode: true
          meshes:
            A:
              '0.03': ${TEST_LOCATION}/0.03.vtk
              '0.02': ${TEST_LOCATION}/0.02.vtk
              '0.01': ${TEST_LOCATION}/0.01.vtk
              '0.008': ${TEST_LOCATION}/0.008.vtk
              '0.006': ${TEST_LOCATION}/0.006.vtk
              '0.004': ${TEST_LOCATION}/0.004.vtk
            B:
              '0.009': ${TEST_LOCATION}/0.009.vtk
        groups:
        - mapping:
            constraints:
            - consistent
            cases:
              np:
                kind: nearest-projection
              nn:
                kind: nearest-neighbor
          meshes:
            A:
            - '0.03'
            - '0.02'
            - '0.01'
            - '0.008'
            - '0.006'
            - '0.004'
            B:
            - '0.009'
    outs:
    - path: examples/mapping_tester/case
      md5: 6a78bc37653ac6958bc3ee37faaf4c4c.dir
      size: 58633842
      nfiles: 250
    - path: examples/mapping_tester/test-statistics.csv
      md5: 28fa3c7cb4b80679ab7addc4647b9400
      size: 3292
  post_process:
    cmd: cd examples/mapping_tester && python3 ../../tools/mapping-tester/plotconv.py
      -f test-statistics.csv
    deps:
    - path: examples/mapping_tester/test-statistics.csv
      md5: 28fa3c7cb4b80679ab7addc4647b9400
      size: 3292
    outs:
    - path: examples/mapping_tester/result-computet.png
      md5: 15a1ea6d13ad01a4c476cf4b5fa512eb
      size: 45627
    - path: examples/mapping_tester/result-error.png
      md5: 67352f456669a2e48d4902e2d7995ce0
      size: 61405
    - path: examples/mapping_tester/result-mapt.png
      md5: 53cf28c9dac9efb292c9cc50d38e3db3
      size: 26921
    - path: examples/mapping_tester/result-peakMemB.png
      md5: 5b380db81c9c127a89e3f97a37d1aee2
      size: 43019
